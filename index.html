<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Project Execution Plan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f7f4;
            color: #3d3d3d;
        }
        /* Chosen Palette: Earthy Neutrals */
        /* Application Structure Plan: A single-page application with a fixed sidebar for navigating project phases. The main view is a dashboard summarizing all challenges. Clicking a phase reveals a dedicated section with an overview chart (donut) and an interactive accordion of execution steps, challenges, and solutions. When a bar in either dashboard chart is clicked, a detailed table of challenges for that category/phase appears. This structure provides both a high-level overview and a progressive disclosure of details, preventing user overload and facilitating targeted exploration. */
        /* Visualization & Content Choices: 1. Overall Challenges (Dashboard): Goal: Compare challenge types across the entire project. Viz: Horizontal Bar Chart (Chart.js). Interaction: Hover for tooltips, Click on bar to filter and display detailed table. Justification: Clearly shows which category (People, Process, Technology) is the most significant source of issues and allows drill-down. 2. Challenges by Phase (Dashboard): Goal: Compare challenges across project phases. Viz: Vertical Bar Chart (Chart.js). Interaction: Hover for tooltips, Click on bar to filter and display detailed table. Justification: Provides an overview of problem areas across different project stages and allows drill-down. 3. Phase-Specific Challenges: Goal: Show challenge proportions within a phase. Viz: Donut Chart (Chart.js). Interaction: Hover. Justification: Quick, visual summary for each section. 4. Execution Steps/Challenges/Solutions: Goal: Organize detailed text. Viz: HTML/Tailwind Accordion. Interaction: Click to expand/collapse. Justification: Manages information density and allows users to focus on specific steps without being overwhelmed. 5. Detailed Challenges Table: Goal: Present filtered challenge data in an organized, explorable format, with each individual challenge statement on its own row. Viz: HTML Table. Interaction: Static display of filtered data. Justification: Provides comprehensive details for a specific challenge category/phase, enhancing readability for multi-part challenges. */
        /* CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .sidebar-link {
            transition: all 0.2s ease-in-out;
        }
        .sidebar-link.active {
            background-color: #eaddd7;
            color: #6d4c41;
            font-weight: 600;
        }
        .sidebar-link:hover {
            background-color: #f0e6e0;
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .tag {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        /* Tag classes are now dynamically assigned via inline style based on challengeTypeColors in JS */


        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-[#f8f7f4]">
    <div class="flex min-h-screen">
        <!-- Sidebar -->
        <aside id="sidebar" class="bg-[#efebe9] w-64 h-screen fixed top-0 left-0 z-20 transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out flex flex-col">
            <div class="p-6">
                <h1 class="text-xl font-bold text-[#6d4c41] mb-2">Project Execution</h1>
                <p class="text-sm text-[#8d6e63]">Interactive Plan</p>
            </div>
            <nav id="navigation" class="mt-4 flex flex-col space-y-1 px-4 flex-1 overflow-y-auto"></nav>
        </aside>

        <!-- Main Content -->
        <main id="main-content" class="flex-1 md:ml-64 transition-all duration-300 ease-in-out">
            <div class="md:hidden p-4 bg-white shadow-md flex justify-between items-center sticky top-0 z-10">
                <h1 class="text-xl font-bold text-[#6d4c41]">Project Execution Plan</h1>
                <button id="menu-toggle" class="text-[#6d4c41] focus:outline-none">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                </button>
            </div>

            <div id="content-container" class="p-4 sm:p-6 lg:p-10">
                <!-- Content will be injected here -->
            </div>
        </main>
    </div>

<script>
const projectData = [
    { category: "Conceptualization & Planning", step: "Formation of Interim Project Core Research Team (CRT)", challenge: "No designated research team exists, leading to a lack of accountability. Excessive workload falls on a single individual. Designated members do not work on the project, burdening others. Different responsibilities are handled by different people, preventing a comprehensive study understanding. Lack of clarity on team composition from the start.", solution: "Establish a dedicated Project Core Research Team (CRT) at project inception, clearly defining roles, responsibilities, and reporting lines for each member, including a senior researcher for oversight. Implement a RACI matrix to ensure accountability and prevent diffused responsibilities.", type: "People/Process" },
    { category: "Conceptualization & Planning", step: "Initial presentation summarising the Concept Proposal", challenge: "Many core members don't have access to key documents before meetings. Members joining mid-project lack orientation. Extensive deviation from the approved research proposal occurs. Terminologies and objectives are open to individual interpretation.", solution: "Implement a centralized, accessible document management system. Develop and implement a standardized onboarding checklist and orientation program for all new team members. Establish a strict change control process for any deviation from the proposal.", type: "Process/People" },
    { category: "Conceptualization & Planning", step: "Initial Kick-off and Planning/Conceptualisation Meeting", challenge: "A study's focus is diluted by trying to test too many innovations. The initial kick-off meeting either doesn't happen or lacks structured planning. Persistent misalignment between organizational vision and project deliverables.", solution: "Define a clear project scope and prioritize objectives. Mandate a formal project kick-off meeting with a predefined agenda and actionable conclusions. Ensure continuous alignment through regular reviews with senior leadership.", type: "Process" },
    { category: "Conceptualization & Planning", step: "Detailed budget adaptation and circulation with key members", challenge: "Young team members experience confusion and lack of clarity. There is no mechanism for constructive, tangible feedback to refine plans.", solution: "Implement a structured mentorship program for junior team members. Establish a formal feedback mechanism for all project deliverables, facilitating structured review sessions.", type: "People" },
    { category: "Introduction of PMS", step: "Assign an Interim/ Permanent Project Manager (PM)", challenge: "Not recruiting or dedicating a project manager at the start of the study causes delays and complicates streamlining efforts later.", solution: "Implement a policy for mandatory PM assignment at the project's initiation. If a permanent PM cannot be immediately recruited, an interim PM must be formally designated with clear responsibilities.", type: "People/Process" },
    { category: "Introduction of PMS", step: "Expand Detailed Timeline with Priority Categorization", challenge: "PMs create timelines from scratch, wasting time. Unachievable milestones are set when projects are already delayed. Lack of prioritization leads to narrow deadlines for PMs while submitted reports remain unreviewed.", solution: "Develop and enforce the use of standardized Gantt chart templates. Conduct thorough feasibility assessments for all milestones. Implement a clear prioritization framework and establish formal review processes with SLAs.", type: "Process" },
    { category: "Introduction of PMS", step: "Introduction & Orientation to PMS", challenge: "PMS orientation is limited to select teams or only PMs. Lack of accessible documentation leads to repetitive queries and difficulties for mid-project joiners.", solution: "Mandate comprehensive PMS orientation for all project stakeholders. Ensure all training sessions are recorded and develop comprehensive user manuals and FAQs within the PMS.", type: "Process/People" },
    { category: "Introduction of PMS", step: "Initiate PMS and Conduct Weekly System Reviews", challenge: "Multiple document versions cause confusion and errors. Locating or accessing files is challenging, especially during handovers. No system ensures timely uploading of all files, leading to incomplete documentation.", solution: "Implement strict version control protocols and standardized file naming. Establish a well-organized, searchable shared document repository. Delegate document management responsibilities to a 'document holder' within the team.", type: "Process/Technology" },
    { category: "Detailed Budget Adaptation", step: "Categorize Budget into 'Negotiable' and 'Locked Zones", challenge: "Project budgets overlook contingencies for delays. Staffing budgets do not reflect ground realities, forcing PMs to operate with inadequate personnel.", solution: "Collaborate with finance and leadership to develop an adaptive budget with contingency allocations. Regularly review and adjust staffing budgets to reflect actual project needs.", type: "Process" },
    { category: "Detailed Budget Adaptation", step: "Plan for excess or exhausted budget", challenge: "PMs are often unaware of the submitted budget. PMs’ suggestions for cost optimization are overlooked. Lack of transparency between PMs and finance on budget utilization.", solution: "Fully inform and involve PMs in the budget process. Empower PMs with a framework for budget flexibility. Establish a transparent communication protocol with the finance department, including regular review meetings.", type: "People/Process" },
    { category: "Detailed Budget Adaptation", step: "Utilise a budgeting software", challenge: "Lack of an integrated budgeting and reimbursement system limits real-time visibility on fund utilization, causing delays and making tracking difficult.", solution: "Advocate for and implement an integrated budgeting and reimbursement software linked to the PMS for real-time tracking and streamlined reimbursements.", type: "Technology/Process" },
    { category: "Team Recruitment Process", step: "Screening and hiring process", challenge: "PMs are overloaded with JD preparation, CV screening, and interviewing, leading to extreme delays in hiring and onboarding.", solution: "Collaborate with HR to streamline the recruitment process. Core HR functions should be managed by HR, with clear SLAs for hiring timelines.", type: "People/Process" },
    { category: "Team Recruitment Process", step: "Interview & Selection process", challenge: "Required team members are not hired even after the project has started. Vacancies as per budget remain unfilled until the project's conclusion. Staffing levels are inconsistent across studies.", solution: "Implement a proactive staffing plan to ensure all members are hired before project commencement. Implement a standardized resource allocation model across all projects.", type: "People/Process" },
    { category: "Team Recruitment Process", step: "On-boarding process", challenge: "PMs manually screen CVs in Excel. Final round interviews are frequently delayed due to other priorities.", solution: "Advocate for AI-powered recruitment tools for initial screening. Prioritize final round interviews as critical path activities and communicate urgency to leadership.", type: "Process/Technology" },
    { category: "Team Recruitment Process", step: "Conduct a meeting for PMs to discuss with team members about the roles and responsibilities", challenge: "Individuals are recruited without adequate knowledge of their position or training. Lack of a standardized onboarding mechanism leads to delays and potential attrition.", solution: "Implement a rigorous pre-employment assessment and a comprehensive onboarding program with detailed job descriptions, clear expectations, and a RACI matrix.", type: "People/Process" },
    { category: "Protocol, Tools & ICF Development", step: "Comprehensive literature review for protocol/tool modification", challenge: "Protocol and tool development is often initiated too late. The entire protocol is drafted by a single individual, lacking peer review, leading to frequent post-submission changes and IEC amendments.", solution: "Integrate protocol development into early project planning. Implement a collaborative drafting process with mandated peer reviews at various stages.", type: "Process" },
    { category: "Protocol, Tools & ICF Development", step: "Development & Expansion, Modifications", challenge: "Lack of organizational AI subscriptions results in generalized documents. Reviewing documents independently instead of on collaborative platforms causes feedback tracking issues. Review meetings are irregular and reactive.", solution: "Advocate for AI tool subscriptions. Mandate the use of collaborative document editing platforms. Establish a regular schedule for proactive review meetings with structured agendas.", type: "Process/Technology" },
    { category: "Protocol, Tools & ICF Development", step: "Finalisation of draft & Approval for IEC Submission", challenge: "Subject matter experts are often unavailable or not identified in time. Inputs from Site PIs/technical experts are taken at the last stage. Junior members often lack guidance.", solution: "Proactively identify and secure SME commitment early. Organize co-development workshops with PIs and experts. Implement a formal mentorship program for junior members.", type: "People" },
    { category: "Protocol, Tools & ICF Development", step: "Site directory formation", challenge: "Standardized templates are not maintained organization-wide. Tasks are assigned without defined ownership or follow-up mechanisms.", solution: "Champion the development of a central library of standardized templates. For every task, clearly define ownership and establish a follow-up mechanism.", type: "Process" },
    { category: "Formation of Expert Committees", step: "DSMB. TAG & Steering Committee Formation (For RCTs)", challenge: "Delayed identification and onboarding of committee members (DSMB, TAG) leads to delays in resolving critical events. Enrollment sometimes starts before the committee is even finalized.", solution: "Proactively identify and onboard expert committee members during the conceptualization phase. Maintain an updated organizational roster of potential experts to draw from.", type: "People/Process" },
    { category: "Formation of Expert Committees", step: "Study Task Force (Internal & External)", challenge: "Roles and responsibilities for committee members are not clearly outlined. Timelines are frequently missed by members, and reviews do not occur within stipulated windows.", solution: "Develop and disseminate standardized guidelines outlining roles, responsibilities, and expected deliverables for all committee members. Establish and enforce strict timelines for reviews.", type: "Process" },
    { category: "Site Selection", step: "Facility Assessment & final site list generation", challenge: "Site selection is often finalized arbitrarily without proper feasibility assessment, leading to wasted time and delays. Site assessments are unstructured and inconsistent.", solution: "Implement a rigorous, data-driven site feasibility assessment process before final selection. Standardize the site evaluation process across all sites with consistent guidance.", type: "Process" },
    { category: "Site Selection", step: "Communication with potential collaborators & stakeholders", challenge: "A concise organizational one-pager is not available for external partners. There is no database of already partnered sites, necessitating re-doing feasibility assessments.", solution: "Ensure a concise, up-to-date organizational one-pager is accessible. Advocate for and utilize an organizational data bank for partnered sites with structured feasibility data.", type: "Technology/Process" },
    { category: "Approvals & Compliance", step: "IEC approvals", challenge: "Protocols and instruments aren't approved until the last minute before filing. Time-consuming printing and filing are also done at the last minute. CVs of key team members are not centrally stored or updated.", solution: "Establish strict internal review schedules well in advance of deadlines. Allocate administrative support for printing/filing. Establish a central repository for updated CVs.", type: "Process" },
    { category: "Approvals & Compliance", step: "MoUs signed with participating sites", challenge: "Queries are answered by senior members due to insufficient time for junior members. Fee payments are delayed. PMs prepare MoUs that face review delays. Required regulatory approvals are identified late.", solution: "Implement a capacity-building program for junior members. Streamline payment mechanisms. Use standardized MoU templates with clear review timelines. Conduct a comprehensive regulatory landscape analysis at the project's outset.", type: "People/Process" },
    { category: "Pre-Implementation Setup", step: "CRFs and PISs review and finalization", challenge: "Tools are finalized in silos without comprehensive input. PMs cannot find reference materials as shared portals are not maintained. Delays in timely reviews and decision-making for CRFs and PISs.", solution: "Mandate a collaborative tool finalization process with all stakeholders. Enforce a policy for all PMs to maintain a shared documentation portal. Organize 'workathon' meetings for real-time consensus.", type: "Process" },
    { category: "Pre-Implementation Setup", step: "Tools REDCap configured and tested", challenge: "Proper SOPs are not available at the study's beginning. The entire responsibility of drafting SOPs falls on PMs, who may lack subject expertise. Pilot test learnings are not effectively integrated.", solution: "Prioritize SOP development, co-developing them with subject experts. Champion a central expert team to create common SOPs. Rigorously integrate pilot learnings into the main study protocol.", type: "People/Process" },
    { category: "Training & Field Readiness", step: "Staff Training sessions", challenge: "Subject matter experts are not identified or made available in time. PMs are left to create training agendas alone, which may lack depth. PMs lead training sessions alone due to expert unavailability.", solution: "Proactively identify and secure SME commitment for training. Mandate leadership review and co-development of training materials. Ensure SMEs are available to co-lead sessions.", type: "People" },
    { category: "Training & Field Readiness", step: "Team standardisation", challenge: "New PMs struggle to anticipate logistical needs due to no standard formats. Admin/Finance teams depend on PMs for exhaustive input without guidance. Admin arrangements are reactive and uncoordinated.", solution: "Develop standardized formats for logistical planning. Establish clear guidelines for Admin/Finance input. Establish a proactive administrative support plan for all training logistics.", type: "Process" },
    { category: "Quality Assurance Protocol & Execution", step: "Development of SOP/ Protocol for QA", challenge: "Subject experts are often occupied, limiting their contribution to QA. Each team operates based on individual past experiences, leading to inconsistent practices.", solution: "Proactively schedule and secure dedicated time from subject experts for QA activities. Develop and enforce organization-wide standardized QA protocols and templates.", type: "People/Process" },
    { category: "Implementation & Monitoring", step: "Site preparedness(Construction), Equipment and logistics procured", challenge: "Inadequate sitting arrangements and lack of space at sites. Recruitment is not done even after implementation has started. No fixed senior member is appointed for guidance.", solution: "Conduct a detailed site readiness assessment before implementation. Ensure all personnel are hired and deployed before implementation begins. Advocate for a dedicated senior point person for guidance.", type: "Process" },
    { category: "Implementation & Monitoring", step: "Participant Recruitment", challenge: "Meetings are not held before recruitment begins. Clear intervention delivery protocols are not prepared or shared. Timely inputs from senior members for co-design workshops are often missing.", solution: "Mandate a pre-recruitment kick-off meeting. Ensure clear, written intervention protocols are disseminated before implementation. Establish a formal feedback loop with clear deadlines for senior team inputs.", type: "People/Process" },
    { category: "Data Collection, Management & Analysis", step: "Data Collection", challenge: "Conflict between organizational goals and protocol objectives creates confusion. Qualitative research is siloed with no cross-learning opportunities.", solution: "Facilitate a clear definition of the project's scope and objectives. Organize cross-project brainstorming meetings and knowledge-sharing sessions for qualitative researchers.", type: "Process/People" },
    { category: "Data Collection, Management & Analysis", step: "Data Analysis, Management & Sharing Plan formation", challenge: "PMs without prior qualitative experience are expected to manage these tasks. Lack of confidence and guidance among young freshers with no mechanism for skill-building.", solution: "Ensure PMs assigned to qualitative tasks receive adequate training and mentorship. Establish a formal mentorship program for young researchers with a repository of self-learning materials.", type: "People" },
    { category: "Dissemination & Publication", step: "Internal dissemination to study team", challenge: "A 'plurality of instructions and guidance' makes execution difficult. Manuscript drafts remain in review for up to 6 months, leading to a lack of motivation.", solution: "Establish a single, clear source of guidance for manuscript writing. Establish strict review timelines (e.g., 2-4 weeks) with a formal process and accountability.", type: "Process/People" },
    { category: "Dissemination & Publication", step: "Stakeholder dissemination", challenge: "Stakeholder dissemination meetings are frequently last-minute and unplanned. Only project-specific staff are involved in manuscript contribution, limiting broader scientific input.", solution: "Develop a well-strategized plan for all stakeholder dissemination meetings. Encourage broader scientific contribution by involving relevant staff from other projects.", type: "Process" },
    { category: "Scale-Up Planning", step: "Scalability assessment", challenge: "Scale-up targets are set without a priori planning or data-driven information. There is no internal planning for HR requirements for scale-up sites, leading to dependency on single individuals and delays.", solution: "Ensure scale-up targets are based on rigorous, data-driven analysis and a scalability assessment. Develop a detailed HR planning component for scale-up, including recruitment and training needs.", type: "Process" },
    { category: "Scale-Up Planning", step: "Consultations with health system / govt", challenge: "Stakeholder mapping and liaisoning with the health system often occur too late, delaying government official onboarding for MoUs and co-designing for scale.", solution: "Initiate stakeholder mapping and liaisoning well in advance of scale-up planning. Proactive engagement with government officials is crucial for securing necessary agreements.", type: "People/Process" }
];

document.addEventListener('DOMContentLoaded', () => {
    const navigation = document.getElementById('navigation');
    const contentContainer = document.getElementById('content-container');
    const menuToggle = document.getElementById('menu-toggle');
    const sidebar = document.getElementById('sidebar');

    const groupedData = projectData.reduce((acc, item) => {
        if (!acc[item.category]) {
            acc[item.category] = [];
        }
        acc[item.category].push(item);
        return acc;
    }, {});

    const phases = ['Dashboard', ...Object.keys(groupedData)];
    let activePhase = 'Dashboard';
    let charts = {};

    // Unified color palette for consistency across all charts and tags
    const challengeTypeColors = {
        'People': { background: '#FDE6D4', border: '#D4804E' }, // Differentiated color for People
        'Process': { background: '#d1c4e9', border: '#311b92' },
        'Technology': { background: '#c8e6c9', border: '#1b5e20' },
        'People + Process': { background: '#ffe0b2', border: '#e65100' },
        'People + Technology': { background: '#d1c4e9', border: '#311b92' },
        'Process + Technology': { background: '#c8e6c9', border: '#1b5e20' },
        'People + Process + Technology': { background: '#a7d9b9', border: '#004d40' },
        'Mixed': { background: '#b0bec5', border: '#263238' }
    };

    function getChallengeType(typeString) {
        const types = typeString.toLowerCase().split('/').map(s => s.trim());
        types.sort(); // Ensure consistent order for combinations

        if (types.includes('people') && types.includes('process') && types.includes('technology')) return 'People + Process + Technology';
        if (types.includes('people') && types.includes('process')) return 'People + Process';
        if (types.includes('people') && types.includes('technology')) return 'People + Technology';
        if (types.includes('process') && types.includes('technology')) return 'Process + Technology';
        if (types.includes('people')) return 'People';
        if (types.includes('process')) return 'Process';
        if (types.includes('technology')) return 'Technology';
        
        return 'Mixed'; // Fallback
    }

    function getTagHtml(typeString) {
        const type = getChallengeType(typeString);
        const colors = challengeTypeColors[type] || challengeTypeColors['Mixed']; // Fallback to mixed if type not found
        return `<span class="tag" style="background-color: ${colors.background}; color: ${colors.border};">${type}</span>`;
    }


    function renderNavigation() {
        navigation.innerHTML = phases.map(phase => `
            <a href="#" class="sidebar-link block py-2.5 px-4 rounded-lg text-sm text-[#5d4037] ${phase === activePhase ? 'active' : ''}" data-phase="${phase}">
                ${phase}
            </a>
        `).join('');
    }

    function renderContent() {
        // Destroy existing chart if any
        for (const chartId in charts) {
            if (charts[chartId]) {
                charts[chartId].destroy();
            }
        }
        charts = {}; // Clear the charts object

        if (activePhase === 'Dashboard') {
            contentContainer.innerHTML = `
                <div class="fade-in">
                    <h2 class="text-3xl font-bold text-[#6d4c41] mb-2">Project Execution Dashboard</h2>
                    <p class="text-lg text-[#8d6e63] mb-8">An overview of challenges across the entire project lifecycle. Click on a bar to see a detailed list of challenges for that category or phase.</p>

                    <div class="grid grid-cols-1 gap-8 mb-8">
                        <div class="bg-white p-6 rounded-2xl shadow-lg border border-gray-200">
                            <h3 class="text-xl font-semibold mb-4 text-[#5d4037]">Challenge Distribution by Type</h3>
                            <p class="text-sm text-gray-600 mb-6">This chart summarizes all identified challenges, categorized into People, Process, and Technology domains. It provides a high-level view of where systemic issues are most prevalent.</p>
                            <div class="chart-container h-96">
                                <canvas id="dashboard-chart-type"></canvas>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-2xl shadow-lg border border-gray-200">
                            <h3 class="text-xl font-semibold mb-4 text-[#5d4037]">Challenges by Project Phase</h3>
                            <p class="text-sm text-gray-600 mb-6">This chart shows the total count of individual challenge statements identified within each project phase, providing insights into which stages face the most hurdles.</p>
                            <p class="text-xs text-gray-500 mt-2">Note: Different shades of green are used for visual distinction between phases and do not indicate specific data values or intensity.</p>
                            <div class="chart-container h-96">
                                <canvas id="dashboard-chart-phase"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            renderDashboardChartType();
            renderChallengesByPhaseChart();
            window.scrollTo(0, 0); // Scroll to top when rendering dashboard
        } else {
            const phaseData = groupedData[activePhase];
            const challengeCounts = phaseData.reduce((acc, item) => {
                const type = getChallengeType(item.type);
                acc[type] = (acc[type] || 0) + 1;
                return acc;
            }, {});

            contentContainer.innerHTML = `
                <div class="fade-in">
                    <h2 class="text-3xl font-bold text-[#6d4c41] mb-2">${activePhase}</h2>
                    <p class="text-lg text-[#8d6e63] mb-8">Exploring the execution steps, challenges, and solutions for the ${activePhase.toLowerCase()} phase.</p>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
                        <div class="lg:col-span-1 bg-white p-6 rounded-2xl shadow-lg border border-gray-200">
                             <h3 class="text-xl font-semibold mb-4 text-[#5d4037]">Challenges in this Phase</h3>
                             <p class="text-sm text-gray-600 mb-6">This chart shows the breakdown of challenges specific to the ${activePhase} phase, offering a quick visual summary of the primary pain points encountered here.</p>
                            <div class="chart-container h-64 md:h-72">
                                <canvas id="phase-chart-${activePhase.replace(/\s/g, '')}"></canvas>
                            </div>
                        </div>
                        <div class="lg:col-span-2 bg-white p-6 rounded-2xl shadow-lg border border-gray-200">
                            <h3 class="text-xl font-semibold mb-4 text-[#5d4037]">Execution Steps & Solutions</h3>
                             <p class="text-sm text-gray-600 mb-6">This section details the specific steps involved in this phase. Click on any step to reveal the associated challenges and the recommended project management solutions for addressing them effectively.</p>
                            <div id="accordion-container" class="space-y-3"></div>
                        </div>
                    </div>
                </div>
            `;
            renderPhaseChart(challengeCounts);
            renderAccordion(phaseData);
            window.scrollTo(0, 0); // Scroll to top for phase detail page
        }
        updateActiveLink();
    }
    
    function renderAccordion(phaseData) {
        const accordionContainer = document.getElementById('accordion-container');
        accordionContainer.innerHTML = phaseData.map((item, index) => `
            <div class="border border-gray-200 rounded-lg overflow-hidden">
                <button class="accordion-toggle w-full text-left p-4 bg-[#f8f7f4] hover:bg-[#f0e6e0] transition flex justify-between items-center">
                    <span class="font-semibold text-[#6d4c41]">${item.step}</span>
                    <svg class="w-5 h-5 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
                <div class="accordion-content bg-white">
                    <div class="p-4 border-t border-gray-200">
                        <h4 class="font-semibold mb-2 text-[#5d4037]">Challenge:</h4>
                        <p class="text-sm mb-4 text-gray-700">${item.challenge}</p>
                        ${getTagHtml(item.type)}
                        <h4 class="font-semibold mt-4 mb-2 text-[#5d4037]">PM Solution:</h4>
                        <p class="text-sm text-gray-700">${item.solution}</p>
                    </div>
                </div>
            </div>
        `).join('');
    }

    const chartConfig = {
        plugins: {
            legend: {
                position: 'bottom',
                labels: {
                    font: { size: 12, family: 'Inter' },
                    color: '#3d3d3d',
                    padding: 20,
                    boxWidth: 12,
                    usePointStyle: true,
                }
            },
            tooltip: {
                backgroundColor: 'rgba(0,0,0,0.7)',
                titleFont: { size: 14, family: 'Inter', weight: 'bold' },
                bodyFont: { size: 12, family: 'Inter' },
                padding: 10,
                cornerRadius: 4,
                displayColors: true,
                callbacks: {
                    label: function(context) {
                        let label = context.dataset.label || '';
                        if (label) {
                            label += ': ';
                        }
                        // Use formattedValue which is explicitly for display
                        label += context.formattedValue;
                        return label;
                    }
                }
            }
        },
        maintainAspectRatio: false,
    };

    function renderDashboardChartType() {
        const allChallenges = projectData.reduce((acc, item) => {
            const type = getChallengeType(item.type);
            acc[type] = (acc[type] || 0) + 1;
            return acc;
        }, {});
        
        const labels = Object.keys(allChallenges);
        const backgroundColors = labels.map(label => challengeTypeColors[label] ? challengeTypeColors[label].background : challengeTypeColors['Mixed'].background);
        const borderColors = labels.map(label => challengeTypeColors[label] ? challengeTypeColors[label].border : challengeTypeColors['Mixed'].border);

        const ctx = document.getElementById('dashboard-chart-type').getContext('2d');
        charts['dashboard-chart-type'] = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Number of Challenges', // This label won't be displayed in the legend
                    data: Object.values(allChallenges),
                    backgroundColor: backgroundColors,
                    borderColor: borderColors,
                    borderWidth: 1,
                    borderRadius: 4
                }]
            },
            options: {
                ...chartConfig,
                indexAxis: 'y', // Horizontal bar chart
                scales: {
                    x: { beginAtZero: true, grid: { color: '#e0e0e0' } },
                    y: { grid: { display: false } }
                },
                plugins: {
                    ...chartConfig.plugins,
                    legend: {
                        display: false // Hide legend for this bar chart
                    }
                },
                onClick: (event, elements) => {
                    if (elements.length > 0) {
                        const clickedElementIndex = elements[0].index;
                        const label = charts['dashboard-chart-type'].data.labels[clickedElementIndex];
                        renderChallengesTable(label);
                    }
                }
            }
        });
    }

    function renderChallengesByPhaseChart() {
        const challengesByPhaseDetailedCount = projectData.reduce((acc, item) => {
            // Split the challenge string into individual sentences/statements
            const challengesArray = item.challenge.split(/\.\s*(?=[A-Z])/).filter(s => s.trim() !== '');
            acc[item.category] = (acc[item.category] || 0) + challengesArray.length;
            return acc;
        }, {});

        const ctx = document.getElementById('dashboard-chart-phase').getContext('2d');
        charts['dashboard-chart-phase'] = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: Object.keys(challengesByPhaseDetailedCount),
                datasets: [{
                    label: 'Total Individual Challenges', // This label won't be displayed in the legend
                    data: Object.values(challengesByPhaseDetailedCount),
                    backgroundColor: ['#a7d9b9', '#78c6a3', '#51af8a', '#2a9871', '#05825d', '#006c4a', '#00573e', '#004230', '#002e21', '#001a13', '#71b191', '#8fd9a9', '#5da589', '#3b8e6f', '#1c7857'], // More shades for distinction
                    borderColor: ['#2a9871', '#05825d', '#006c4a', '#00573e', '#004230', '#002e21', '#001a13', '#00100a', '#000805', '#000302', '#549c77', '#7abf95', '#498a6f', '#2f7457', '#125c3e'],
                    borderWidth: 1,
                    borderRadius: 4
                }]
            },
            options: {
                ...chartConfig,
                scales: {
                    x: { beginAtZero: true, grid: { display: false }, ticks: { autoSkip: false, maxRotation: 45, minRotation: 45 } },
                    y: { grid: { color: '#e0e0e0' } }
                },
                plugins: {
                    ...chartConfig.plugins,
                    legend: {
                        display: false // Hide legend for this bar chart
                    }
                },
                onClick: (event, elements) => {
                    if (elements.length > 0) {
                        const clickedElementIndex = elements[0].index;
                        const label = charts['dashboard-chart-phase'].data.labels[clickedElementIndex];
                        renderPhaseChallengesTable(label);
                    }
                }
            }
        });
    }


    function renderPhaseChart(challengeCounts) {
        const canvasId = `phase-chart-${activePhase.replace(/\s/g, '')}`;
        const ctx = document.getElementById(canvasId).getContext('2d');
        const labels = Object.keys(challengeCounts);

        const backgroundColors = labels.map(label => challengeTypeColors[label] ? challengeTypeColors[label].background : challengeTypeColors['Mixed'].background);
        const borderColors = labels.map(label => challengeTypeColors[label] ? challengeTypeColors[label].border : challengeTypeColors['Mixed'].border);

        charts[activePhase] = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: labels,
                datasets: [{
                    data: Object.values(challengeCounts),
                    backgroundColor: backgroundColors,
                    borderColor: '#fff', // Donut chart white border
                    borderWidth: 2,
                }]
            },
            options: { ...chartConfig, cutout: '60%' }
        });
    }

    function renderChallengesTable(challengeType) {
        const filteredChallenges = projectData.filter(item => getChallengeType(item.type) === challengeType);

        let tableRowsHtml = '';
        filteredChallenges.forEach(item => {
            // Split the challenge string into individual sentences
            const challengesArray = item.challenge.split(/\.\s*(?=[A-Z])/).filter(s => s.trim() !== ''); // Split by period followed by a space and an uppercase letter, then filter empty strings
            
            challengesArray.forEach((singleChallenge, index) => {
                tableRowsHtml += `
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item.category}</td>
                        <td class="px-6 py-4 whitespace-normal text-sm text-gray-700">${item.step}</td>
                        <td class="px-6 py-4 whitespace-normal text-sm text-gray-700">${singleChallenge.trim() + (singleChallenge.endsWith('.') ? '' : '.')}</td> <!-- Add back period if missing -->
                        <td class="px-6 py-4 whitespace-normal text-sm text-gray-700">${item.solution}</td>
                    </tr>
                `;
            });
        });


        contentContainer.innerHTML = `
            <div class="fade-in">
                <button id="back-to-dashboard-top" class="mb-4 px-6 py-2 bg-[#6d4c41] text-white rounded-lg shadow hover:bg-[#5d4037] transition">← Back to Dashboard</button>
                <h2 class="text-3xl font-bold text-[#6d4c41] mb-2">Detailed Challenges: ${challengeType}</h2>
                <p class="text-lg text-[#8d6e63] mb-8">Below is a comprehensive list of all challenges categorized as '${challengeType}', with each specific challenge statement presented on its own row, along with their respective project phases, operational steps, and proposed solutions. This granular view helps in understanding individual pain points more clearly.</p>
                <div class="bg-white p-6 rounded-2xl shadow-lg border border-gray-200 overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-[#f8f7f4]">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-[#5d4037] uppercase tracking-wider rounded-tl-lg">Project Phase</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-[#5d4037] uppercase tracking-wider">Operational Step</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-[#5d4037] uppercase tracking-wider">Challenge</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-[#5d4037] uppercase tracking-wider rounded-tr-lg">Solution</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            ${tableRowsHtml}
                        </tbody>
                    </table>
                </div>
                <button id="back-to-dashboard-bottom" class="mt-8 px-6 py-2 bg-[#6d4c41] text-white rounded-lg shadow hover:bg-[#5d4037] transition">← Back to Dashboard</button>
            </div>
        `;
        window.scrollTo(0, 0); // Scroll to top when rendering table

        document.getElementById('back-to-dashboard-top').addEventListener('click', () => {
            activePhase = 'Dashboard';
            renderContent();
        });
        document.getElementById('back-to-dashboard-bottom').addEventListener('click', () => {
            activePhase = 'Dashboard';
            renderContent();
        });
    }

    function renderPhaseChallengesTable(phaseName) {
        const filteredChallenges = projectData.filter(item => item.category === phaseName);

        let tableRowsHtml = '';
        filteredChallenges.forEach(item => {
            const challengesArray = item.challenge.split(/\.\s*(?=[A-Z])/).filter(s => s.trim() !== '');
            
            challengesArray.forEach((singleChallenge, index) => {
                tableRowsHtml += `
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item.category}</td>
                        <td class="px-6 py-4 whitespace-normal text-sm text-gray-700">${item.step}</td>
                        <td class="px-6 py-4 whitespace-normal text-sm text-gray-700">${singleChallenge.trim() + (singleChallenge.endsWith('.') ? '' : '.')}</td>
                        <td class="px-6 py-4 whitespace-normal text-sm text-gray-700">${getChallengeType(item.type)}</td>
                        <td class="px-6 py-4 whitespace-normal text-sm text-gray-700">${item.solution}</td>
                    </tr>
                `;
            });
        });

        contentContainer.innerHTML = `
            <div class="fade-in">
                <button id="back-to-dashboard-top" class="mb-4 px-6 py-2 bg-[#6d4c41] text-white rounded-lg shadow hover:bg-[#5d4037] transition">← Back to Dashboard</button>
                <h2 class="text-3xl font-bold text-[#6d4c41] mb-2">Detailed Challenges for: ${phaseName}</h2>
                <p class="text-lg text-[#8d6e63] mb-8">Below is a comprehensive list of all challenges identified within the '${phaseName}' phase, with each specific challenge statement presented on its own row, along with their respective operational steps, challenge type, and proposed solutions. This granular view helps in understanding individual pain points more clearly for this phase.</p>
                <div class="bg-white p-6 rounded-2xl shadow-lg border border-gray-200 overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-[#f8f7f4]">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-[#5d4037] uppercase tracking-wider rounded-tl-lg">Project Phase</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-[#5d4037] uppercase tracking-wider">Operational Step</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-[#5d4037] uppercase tracking-wider">Challenge</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-[#5d4037] uppercase tracking-wider">Category</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-[#5d4037] uppercase tracking-wider rounded-tr-lg">Solution</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            ${tableRowsHtml}
                        </tbody>
                    </table>
                </div>
                <button id="back-to-dashboard-bottom" class="mt-8 px-6 py-2 bg-[#6d4c41] text-white rounded-lg shadow hover:bg-[#5d4037] transition">← Back to Dashboard</button>
            </div>
        `;
        window.scrollTo(0, 0); // Scroll to top when rendering table

        document.getElementById('back-to-dashboard-top').addEventListener('click', () => {
            activePhase = 'Dashboard';
            renderContent();
        });
        document.getElementById('back-to-dashboard-bottom').addEventListener('click', () => {
            activePhase = 'Dashboard';
            renderContent();
        });
    }

    function updateActiveLink() {
        document.querySelectorAll('.sidebar-link').forEach(link => {
            if (link.dataset.phase === activePhase) {
                link.classList.add('active');
            } else {
                link.classList.remove('active');
            }
        });
    }

    function handleNavClick(e) {
        e.preventDefault();
        const targetPhase = e.target.closest('.sidebar-link').dataset.phase;
        if (targetPhase) { // Ensure a phase was clicked
            if (targetPhase === 'Dashboard') {
                activePhase = 'Dashboard'; // Ensure activePhase is correct
                renderContent(); // Force re-render of dashboard
            } else if (targetPhase !== activePhase) {
                activePhase = targetPhase;
                renderContent();
            }
        }
        if (window.innerWidth < 768) {
            sidebar.classList.add('-translate-x-full');
        }
    }

    function handleAccordionToggle(e) {
        const button = e.target.closest('.accordion-toggle');
        if (button) {
            const content = button.nextElementSibling;
            const icon = button.querySelector('svg');
            
            if (content.style.maxHeight) {
                content.style.maxHeight = null;
                icon.classList.remove('rotate-180');
            } else {
                // Close other open accordions
                document.querySelectorAll('.accordion-content').forEach(el => el.style.maxHeight = null);
                document.querySelectorAll('.accordion-toggle svg').forEach(svg => svg.classList.remove('rotate-180'));

                content.style.maxHeight = content.scrollHeight + "px";
                icon.classList.add('rotate-180');
            }
        }
    }

    navigation.addEventListener('click', handleNavClick);
    // Event delegation for accordion toggles within contentContainer
    contentContainer.addEventListener('click', handleAccordionToggle);

    menuToggle.addEventListener('click', () => {
        sidebar.classList.toggle('-translate-x-full');
    });

    // Initial Render
    renderNavigation();
    renderContent();
});

</script>
</body>
</html>
